import{i as ge,b as pe,a as z,c as H,d as Q,e as J,f as ye,g as be,h as ve,j as xe,r as je,t as k,k as we,l as _e,m as Ne,n as W,o as Se,p as Ae,q as M,s as l,L as U,u as O,v as E,w as q,x as S,y as G,z as Ce,A as Fe,B as Be,C as T,D as C,E as $e,F as ee,G as x,H as K,I as te,J as Me,K as se,M as D,P as qe,N as Le,O as De,Q as Pe,R as ne,S as Ue,T as Ee,U as re,V as Ke,W as Te,X as V,Y as Ve,Z as ae,_ as ie,$ as Ie,a0 as oe,a1 as Oe,a2 as Re,a3 as Qe,a4 as P,a5 as ze,a6 as He,a7 as ke,a8 as L,a9 as Ge}from"./index-bT8zLw0g.js";import{F as I,a as B}from"./FormElement-CehwJ9q2.js";var Ze="[object Number]";function We(r){return typeof r=="number"||ge(r)&&pe(r)==Ze}function Xe(r,i){return r<i}function Ye(r,i,u){for(var c=-1,d=r.length;++c<d;){var f=r[c],m=i(f);if(m!=null&&(h===void 0?m===m&&!z(m):u(m,h)))var h=m,p=f}return p}function Je(r,i){return r&&r.length?Ye(r,H(i),Xe):void 0}var et="Expected a function";function tt(r){if(typeof r!="function")throw new TypeError(et);return function(){var i=arguments;switch(i.length){case 0:return!r.call(this);case 1:return!r.call(this,i[0]);case 2:return!r.call(this,i[0],i[1]);case 3:return!r.call(this,i[0],i[1],i[2])}return!r.apply(this,i)}}function st(r,i){var u=r.length;for(r.sort(i);u--;)r[u]=r[u].value;return r}function nt(r,i){if(r!==i){var u=r!==void 0,c=r===null,d=r===r,f=z(r),m=i!==void 0,h=i===null,p=i===i,y=z(i);if(!h&&!y&&!f&&r>i||f&&m&&p&&!h&&!y||c&&m&&p||!u&&p||!d)return 1;if(!c&&!f&&!y&&r<i||y&&u&&d&&!c&&!f||h&&u&&d||!m&&d||!p)return-1}return 0}function rt(r,i,u){for(var c=-1,d=r.criteria,f=i.criteria,m=d.length,h=u.length;++c<m;){var p=nt(d[c],f[c]);if(p){if(c>=h)return p;var y=u[c];return p*(y=="desc"?-1:1)}}return r.index-i.index}function at(r,i,u){i.length?i=Q(i,function(f){return J(f)?function(m){return ye(m,f.length===1?f[0]:f)}:f}):i=[be];var c=-1;i=Q(i,ve(H));var d=xe(r,function(f,m,h){var p=Q(i,function(y){return y(f)});return{criteria:p,index:++c,value:f}});return st(d,function(f,m){return rt(f,m,u)})}var it=/^\s+/,ot=je.parseInt;function X(r,i,u){return u||i==null?i=0:i&&(i=+i),ot(k(r).replace(it,""),i||0)}function le(r,i){var u=J(r)?we:_e;return u(r,tt(H(i)))}var lt=Ne(function(r,i){if(r==null)return[];var u=i.length;return u>1&&W(r,i[0],i[1])?i=[]:u>2&&W(i[0],i[1],i[2])&&(i=[i[0]]),at(r,Se(i),[])});function ut(r,i){const u=Ae(r,i==null?void 0:i.in);if(isNaN(+u))throw new RangeError("Invalid time value");let c="",d="";const f="-",m=":";{const h=M(u.getDate(),2),p=M(u.getMonth()+1,2);c=`${M(u.getFullYear(),4)}${f}${p}${f}${h}`}{const h=u.getTimezoneOffset();if(h!==0){const v=Math.abs(h),w=M(Math.trunc(v/60),2),j=M(v%60,2);d=`${h<0?"+":"-"}${w}:${j}`}else d="Z";const p=M(u.getHours(),2),y=M(u.getMinutes(),2),b=M(u.getSeconds(),2),N=c===""?"":"T",A=[p,y,b].join(m);c=`${c}${N}${A}${d}`}return c}const ct=()=>l.jsx("header",{className:"my-16 w-11/12 place-self-center",children:l.jsxs("div",{className:"flex flex-wrap justify-between gap-8 rounded-md bg-purple-300 p-2",children:[l.jsx(U,{to:"/admin/doors",content:"Luker",className:"rounded-md"}),l.jsx(U,{to:"/admin/doors/new",content:"Ny luke",className:"rounded-md"}),l.jsx(U,{to:"/admin/service_messages",content:"Driftsmeldinger",className:"rounded-md"}),l.jsx(U,{to:"/admin/service_messages/new",content:"Ny driftsmelding",className:"rounded-md"})]})}),ue=async()=>await S.get("/admin/challenges").then(({data:r})=>Fe(r,"door")),R=r=>O({queryKey:["admin","challenges"],queryFn:ue,staleTime:6e5,...r}),ce=r=>O({queryKey:["admin","challenges"],queryFn:ue,staleTime:6e5,select:r?Ce(r):void 0}),dt=r=>S.get(`/admin/challenges/${G(r)}/posts`).then(({data:i})=>i),ft=r=>O({queryKey:["admin","posts",r],queryFn:()=>dt(r),staleTime:3e5}),ht=async r=>{if(r=Be(r,["markdown_content","files"]),!T(r))return await S.post("/admin/challenge_markdown",{challenge:r}).then(({data:i})=>i)},mt=(r,i)=>O({queryKey:["admin","challenges","preview",r],queryFn:()=>ht(r),staleTime:1/0,...i}),gt=()=>{const r=E();return q({mutationKey:["admin","challenges","create"],mutationFn:({challenge:i})=>S.post("/admin/challenges",{challenge:i}),onSuccess:()=>{r.invalidateQueries({queryKey:["challenges"]}),r.invalidateQueries({queryKey:["admin","challenges"]})}})},pt=()=>{const r=E();return q({mutationKey:["admin","challenges","update"],mutationFn:({challenge:i})=>S.patch(`/admin/challenges/${G(i.door)}`,{challenge:i}),onSuccess:()=>{r.invalidateQueries({queryKey:["challenges"]}),r.invalidateQueries({queryKey:["admin","challenges"]})}})},yt=()=>{const r=E();return q({mutationKey:["admin","challenges","destroy"],mutationFn:async({door:i})=>We(i)&&S.delete(`/admin/challenges/${G(i)}`),onSuccess:()=>{r.invalidateQueries({queryKey:["challenges"]}),r.invalidateQueries({queryKey:["admin","challenges"]})}})},bt=()=>{const r=E();return q({mutationKey:["admin","serviceMessages","create"],mutationFn:i=>S.post("/admin/service_messages",i),onSuccess:()=>{r.invalidateQueries({queryKey:["serviceMessages"]})}})},vt=()=>{const r=E();return q({mutationKey:["admin","serviceMessages","update"],mutationFn:({uuid:i,...u})=>S.patch(`/admin/service_messages/${i}`,u),onSuccess:()=>{r.invalidateQueries({queryKey:["serviceMessages"]})}})},xt=()=>{const r=E();return q({mutationKey:["admin","serviceMessages","delete"],mutationFn:({uuid:i})=>S.delete(`/admin/service_messages/${i}`),onSuccess:()=>{r.invalidateQueries({queryKey:["serviceMessages"]})}})},jt=()=>q({mutationKey:["admin","activeStorage","createBlob"],mutationFn:({blob:r,config:i})=>S.post("/rails/active_storage/direct_uploads",{blob:r},i).then(({data:u})=>u)}),wt=()=>q({mutationKey:["admin","activeStorage","uploadFile"],mutationFn:({upload:{file:r,directUpload:i},config:u})=>S.put(i.url,r,{...u,headers:i.headers})}),_t=({door:r,setDoor:i})=>{const{data:u}=R();return u?l.jsx("label",{className:"block space-x-8",children:l.jsx("select",{className:"form-select text-black",defaultValue:r,onChange:c=>i(parseInt(c.target.value)),children:C(lt($e(ee(u)),"door"),({door:c,title:d},f)=>l.jsx("option",{value:c,label:`Luke ${c}: ${d}`,children:`Luke ${c}: ${d}`},f))})}):null},Nt=()=>{var N;const r=K(),{search:i}=te(),u=(N=i.match(/door=(?<door>\d+)/))==null?void 0:N.groups,{data:c}=R(),d=x.useMemo(()=>Je(ee(c),"door"),[c]),{mutate:f,isPending:m}=yt(),h=()=>{window.confirm(`Er du sikker p친 at du vil slette luke ${p} "${b==null?void 0:b.title}"?`)&&f({door:p},{onSuccess:()=>{y(void 0),r("/admin/doors")}})},[p,y]=x.useState(u&&parseInt(u.door));x.useLayoutEffect(()=>{y(A=>A??(d==null?void 0:d.door))},[y,d]);const{data:b}=ce(p??(d==null?void 0:d.door));return Me(p)?null:l.jsxs("div",{className:"w-11/12",children:[l.jsx(se,{challenge:b,withoutInput:!0,preamble:l.jsxs("div",{className:"mb-16 flex w-full flex-wrap justify-between gap-y-6",children:[l.jsx(_t,{door:p,setDoor:y}),l.jsxs("div",{className:"flex gap-6",children:[l.jsx(U,{to:`/admin/doors/${p}/edit`,content:"Rediger luke"})," ",l.jsx(D,{disabled:m,onClick:h,children:"Slett luke"})]})]})}),l.jsx(qe,{door:p,usePosts:ft,withoutInput:!0})]})},St=x.memo(Nt),de=()=>{const{data:r}=R();return le(Le(1,25),i=>De(r,i))};var fe={exports:{}};(function(r,i){(function(u){r.exports=u()})(function(u){var c=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function d(o,a){var t=o[0],e=o[1],n=o[2],s=o[3];t+=(e&n|~e&s)+a[0]-680876936|0,t=(t<<7|t>>>25)+e|0,s+=(t&e|~t&n)+a[1]-389564586|0,s=(s<<12|s>>>20)+t|0,n+=(s&t|~s&e)+a[2]+606105819|0,n=(n<<17|n>>>15)+s|0,e+=(n&s|~n&t)+a[3]-1044525330|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&s)+a[4]-176418897|0,t=(t<<7|t>>>25)+e|0,s+=(t&e|~t&n)+a[5]+1200080426|0,s=(s<<12|s>>>20)+t|0,n+=(s&t|~s&e)+a[6]-1473231341|0,n=(n<<17|n>>>15)+s|0,e+=(n&s|~n&t)+a[7]-45705983|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&s)+a[8]+1770035416|0,t=(t<<7|t>>>25)+e|0,s+=(t&e|~t&n)+a[9]-1958414417|0,s=(s<<12|s>>>20)+t|0,n+=(s&t|~s&e)+a[10]-42063|0,n=(n<<17|n>>>15)+s|0,e+=(n&s|~n&t)+a[11]-1990404162|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&s)+a[12]+1804603682|0,t=(t<<7|t>>>25)+e|0,s+=(t&e|~t&n)+a[13]-40341101|0,s=(s<<12|s>>>20)+t|0,n+=(s&t|~s&e)+a[14]-1502002290|0,n=(n<<17|n>>>15)+s|0,e+=(n&s|~n&t)+a[15]+1236535329|0,e=(e<<22|e>>>10)+n|0,t+=(e&s|n&~s)+a[1]-165796510|0,t=(t<<5|t>>>27)+e|0,s+=(t&n|e&~n)+a[6]-1069501632|0,s=(s<<9|s>>>23)+t|0,n+=(s&e|t&~e)+a[11]+643717713|0,n=(n<<14|n>>>18)+s|0,e+=(n&t|s&~t)+a[0]-373897302|0,e=(e<<20|e>>>12)+n|0,t+=(e&s|n&~s)+a[5]-701558691|0,t=(t<<5|t>>>27)+e|0,s+=(t&n|e&~n)+a[10]+38016083|0,s=(s<<9|s>>>23)+t|0,n+=(s&e|t&~e)+a[15]-660478335|0,n=(n<<14|n>>>18)+s|0,e+=(n&t|s&~t)+a[4]-405537848|0,e=(e<<20|e>>>12)+n|0,t+=(e&s|n&~s)+a[9]+568446438|0,t=(t<<5|t>>>27)+e|0,s+=(t&n|e&~n)+a[14]-1019803690|0,s=(s<<9|s>>>23)+t|0,n+=(s&e|t&~e)+a[3]-187363961|0,n=(n<<14|n>>>18)+s|0,e+=(n&t|s&~t)+a[8]+1163531501|0,e=(e<<20|e>>>12)+n|0,t+=(e&s|n&~s)+a[13]-1444681467|0,t=(t<<5|t>>>27)+e|0,s+=(t&n|e&~n)+a[2]-51403784|0,s=(s<<9|s>>>23)+t|0,n+=(s&e|t&~e)+a[7]+1735328473|0,n=(n<<14|n>>>18)+s|0,e+=(n&t|s&~t)+a[12]-1926607734|0,e=(e<<20|e>>>12)+n|0,t+=(e^n^s)+a[5]-378558|0,t=(t<<4|t>>>28)+e|0,s+=(t^e^n)+a[8]-2022574463|0,s=(s<<11|s>>>21)+t|0,n+=(s^t^e)+a[11]+1839030562|0,n=(n<<16|n>>>16)+s|0,e+=(n^s^t)+a[14]-35309556|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^s)+a[1]-1530992060|0,t=(t<<4|t>>>28)+e|0,s+=(t^e^n)+a[4]+1272893353|0,s=(s<<11|s>>>21)+t|0,n+=(s^t^e)+a[7]-155497632|0,n=(n<<16|n>>>16)+s|0,e+=(n^s^t)+a[10]-1094730640|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^s)+a[13]+681279174|0,t=(t<<4|t>>>28)+e|0,s+=(t^e^n)+a[0]-358537222|0,s=(s<<11|s>>>21)+t|0,n+=(s^t^e)+a[3]-722521979|0,n=(n<<16|n>>>16)+s|0,e+=(n^s^t)+a[6]+76029189|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^s)+a[9]-640364487|0,t=(t<<4|t>>>28)+e|0,s+=(t^e^n)+a[12]-421815835|0,s=(s<<11|s>>>21)+t|0,n+=(s^t^e)+a[15]+530742520|0,n=(n<<16|n>>>16)+s|0,e+=(n^s^t)+a[2]-995338651|0,e=(e<<23|e>>>9)+n|0,t+=(n^(e|~s))+a[0]-198630844|0,t=(t<<6|t>>>26)+e|0,s+=(e^(t|~n))+a[7]+1126891415|0,s=(s<<10|s>>>22)+t|0,n+=(t^(s|~e))+a[14]-1416354905|0,n=(n<<15|n>>>17)+s|0,e+=(s^(n|~t))+a[5]-57434055|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~s))+a[12]+1700485571|0,t=(t<<6|t>>>26)+e|0,s+=(e^(t|~n))+a[3]-1894986606|0,s=(s<<10|s>>>22)+t|0,n+=(t^(s|~e))+a[10]-1051523|0,n=(n<<15|n>>>17)+s|0,e+=(s^(n|~t))+a[1]-2054922799|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~s))+a[8]+1873313359|0,t=(t<<6|t>>>26)+e|0,s+=(e^(t|~n))+a[15]-30611744|0,s=(s<<10|s>>>22)+t|0,n+=(t^(s|~e))+a[6]-1560198380|0,n=(n<<15|n>>>17)+s|0,e+=(s^(n|~t))+a[13]+1309151649|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~s))+a[4]-145523070|0,t=(t<<6|t>>>26)+e|0,s+=(e^(t|~n))+a[11]-1120210379|0,s=(s<<10|s>>>22)+t|0,n+=(t^(s|~e))+a[2]+718787259|0,n=(n<<15|n>>>17)+s|0,e+=(s^(n|~t))+a[9]-343485551|0,e=(e<<21|e>>>11)+n|0,o[0]=t+o[0]|0,o[1]=e+o[1]|0,o[2]=n+o[2]|0,o[3]=s+o[3]|0}function f(o){var a=[],t;for(t=0;t<64;t+=4)a[t>>2]=o.charCodeAt(t)+(o.charCodeAt(t+1)<<8)+(o.charCodeAt(t+2)<<16)+(o.charCodeAt(t+3)<<24);return a}function m(o){var a=[],t;for(t=0;t<64;t+=4)a[t>>2]=o[t]+(o[t+1]<<8)+(o[t+2]<<16)+(o[t+3]<<24);return a}function h(o){var a=o.length,t=[1732584193,-271733879,-1732584194,271733878],e,n,s,_,F,$;for(e=64;e<=a;e+=64)d(t,f(o.substring(e-64,e)));for(o=o.substring(e-64),n=o.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)s[e>>2]|=o.charCodeAt(e)<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),e>55)for(d(t,s),e=0;e<16;e+=1)s[e]=0;return _=a*8,_=_.toString(16).match(/(.*?)(.{0,8})$/),F=parseInt(_[2],16),$=parseInt(_[1],16)||0,s[14]=F,s[15]=$,d(t,s),t}function p(o){var a=o.length,t=[1732584193,-271733879,-1732584194,271733878],e,n,s,_,F,$;for(e=64;e<=a;e+=64)d(t,m(o.subarray(e-64,e)));for(o=e-64<a?o.subarray(e-64):new Uint8Array(0),n=o.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)s[e>>2]|=o[e]<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),e>55)for(d(t,s),e=0;e<16;e+=1)s[e]=0;return _=a*8,_=_.toString(16).match(/(.*?)(.{0,8})$/),F=parseInt(_[2],16),$=parseInt(_[1],16)||0,s[14]=F,s[15]=$,d(t,s),t}function y(o){var a="",t;for(t=0;t<4;t+=1)a+=c[o>>t*8+4&15]+c[o>>t*8&15];return a}function b(o){var a;for(a=0;a<o.length;a+=1)o[a]=y(o[a]);return o.join("")}b(h("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function o(a,t){return a=a|0||0,a<0?Math.max(a+t,0):Math.min(a,t)}ArrayBuffer.prototype.slice=function(a,t){var e=this.byteLength,n=o(a,e),s=e,_,F,$,Z;return t!==u&&(s=o(t,e)),n>s?new ArrayBuffer(0):(_=s-n,F=new ArrayBuffer(_),$=new Uint8Array(F),Z=new Uint8Array(this,n,_),$.set(Z),F)}}();function N(o){return/[\u0080-\uFFFF]/.test(o)&&(o=unescape(encodeURIComponent(o))),o}function A(o,a){var t=o.length,e=new ArrayBuffer(t),n=new Uint8Array(e),s;for(s=0;s<t;s+=1)n[s]=o.charCodeAt(s);return a?n:e}function v(o){return String.fromCharCode.apply(null,new Uint8Array(o))}function w(o,a,t){var e=new Uint8Array(o.byteLength+a.byteLength);return e.set(new Uint8Array(o)),e.set(new Uint8Array(a),o.byteLength),e}function j(o){var a=[],t=o.length,e;for(e=0;e<t-1;e+=2)a.push(parseInt(o.substr(e,2),16));return String.fromCharCode.apply(String,a)}function g(){this.reset()}return g.prototype.append=function(o){return this.appendBinary(N(o)),this},g.prototype.appendBinary=function(o){this._buff+=o,this._length+=o.length;var a=this._buff.length,t;for(t=64;t<=a;t+=64)d(this._hash,f(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},g.prototype.end=function(o){var a=this._buff,t=a.length,e,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s;for(e=0;e<t;e+=1)n[e>>2]|=a.charCodeAt(e)<<(e%4<<3);return this._finish(n,t),s=b(this._hash),o&&(s=j(s)),this.reset(),s},g.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},g.prototype.setState=function(o){return this._buff=o.buff,this._length=o.length,this._hash=o.hash,this},g.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},g.prototype._finish=function(o,a){var t=a,e,n,s;if(o[t>>2]|=128<<(t%4<<3),t>55)for(d(this._hash,o),t=0;t<16;t+=1)o[t]=0;e=this._length*8,e=e.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(e[2],16),s=parseInt(e[1],16)||0,o[14]=n,o[15]=s,d(this._hash,o)},g.hash=function(o,a){return g.hashBinary(N(o),a)},g.hashBinary=function(o,a){var t=h(o),e=b(t);return a?j(e):e},g.ArrayBuffer=function(){this.reset()},g.ArrayBuffer.prototype.append=function(o){var a=w(this._buff.buffer,o),t=a.length,e;for(this._length+=o.byteLength,e=64;e<=t;e+=64)d(this._hash,m(a.subarray(e-64,e)));return this._buff=e-64<t?new Uint8Array(a.buffer.slice(e-64)):new Uint8Array(0),this},g.ArrayBuffer.prototype.end=function(o){var a=this._buff,t=a.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n,s;for(n=0;n<t;n+=1)e[n>>2]|=a[n]<<(n%4<<3);return this._finish(e,t),s=b(this._hash),o&&(s=j(s)),this.reset(),s},g.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.ArrayBuffer.prototype.getState=function(){var o=g.prototype.getState.call(this);return o.buff=v(o.buff),o},g.ArrayBuffer.prototype.setState=function(o){return o.buff=A(o.buff,!0),g.prototype.setState.call(this,o)},g.ArrayBuffer.prototype.destroy=g.prototype.destroy,g.ArrayBuffer.prototype._finish=g.prototype._finish,g.ArrayBuffer.hash=function(o,a){var t=p(new Uint8Array(o)),e=b(t);return a?j(e):e},g})})(fe);var At=fe.exports;const Ct=Pe(At),Ft=()=>{const r=x.useRef(!0),i=x.useCallback(()=>r.current,[]);return x.useEffect(()=>()=>void(r.current=!1),[]),i};let Y=0;const Bt=({challenge:r,register:i,setValue:u,className:c})=>{i("files");const{mutateAsync:d}=jt(),{mutateAsync:f}=wt(),[m,h]=x.useState(C(r.files,v=>({...v,fileId:Y++})));x.useEffect(()=>{u("files",C(m,"signed_id"))},[u,m]);const[p,y]=x.useState({}),b=Ft(),N=async v=>{await Promise.all(C(v,async w=>{const j=Y++;y(e=>({...e,[j]:{progress:0}}));const g={filename:w.name,content_type:w.type,byte_size:w.size,checksum:btoa(Ct.ArrayBuffer.hash(await w.arrayBuffer(),!0))},{signed_id:o,direct_upload:a}=await d({blob:g});!b()||(h(e=>[...e,{signed_id:o,filename:w.name,fileId:j}]),await f({upload:{file:w,directUpload:a},config:{onUploadProgress:({loaded:e,total:n})=>{b()&&Ue(n)&&y(s=>({...s,[j]:{progress:e/n}}))}}}),!b())||y(e=>({...e,[j]:{progress:1}}))}))},A=x.useRef(null);return l.jsxs("div",{className:ne("space-y-4",c),children:[l.jsxs(I,{label:"Filer",note:"husk 친 dobbeltsjekke riktig filnavn i markdown",children:[l.jsx("input",{ref:A,className:"hidden",type:"file",multiple:!0,onChange:({target:{files:v}})=>v&&N(v)}),l.jsx(D,{className:"form-input block",type:"button",content:"Velg filer...",onClick:()=>{var v;return(v=A.current)==null?void 0:v.click()}})]}),l.jsx("div",{className:"grid grid-cols-4 gap-4",children:C(m,({filename:v,signed_id:w,fileId:j})=>{var o;const g=((o=p[j])==null?void 0:o.progress)??1;return l.jsxs("span",{className:"relative overflow-hidden rounded-md border-2 border-yellow-400 p-2 text-center",children:[g<1&&l.jsx("div",{style:{width:`calc(${g*100}% + ${g*.5}rem)`},className:"absolute -left-2 -top-2 h-[calc(100%+.5rem)] bg-purple-400/20"}),l.jsx("span",{className:"line-clamp-1 inline-block w-[calc(100%-1.5rem)]",children:v}),l.jsx(Ee,{className:"absolute right-4 top-0 h-full w-6 cursor-pointer",onClick:()=>h(a=>le(a,{signed_id:w}))})]},w)})})]})},$t=({challenge:r,newForm:i=!1,submit:u})=>{const[c,d]=x.useState(!1),{register:f,handleSubmit:m,setValue:h,getValues:p,watch:y,formState:{dirtyFields:{door:b}}}=re({defaultValues:{...r,files:C(r.files,"signed_id")}}),[N,A]=x.useState(),{data:v}=mt(N,{enabled:c}),w=()=>{d(t=>(A(t?void 0:p()),!t))},j=de(),g=y("door"),o=r.active_from??Ke(b?g:r.door),a=r.active_to??Te();return l.jsxs("div",{className:"space-y-16",children:[l.jsxs("form",{className:"space-y-8",onSubmit:m(t=>u({...t,door:b?g:r.door})),children:[l.jsxs("div",{className:"flex w-full justify-end gap-8",children:[l.jsx(D,{type:"submit",children:"Lagre"}),l.jsx(D,{type:"button",className:"uppercase",onClick:w,children:c?"Rediger":"Forh친ndsvisning"})]}),l.jsxs("div",{className:ne("grid grid-cols-3 gap-8",c&&"hidden"),children:[i&&l.jsx(I,{label:"Luke",className:"col-span-3",children:l.jsx("select",{className:"form-select block w-full text-black",defaultValue:j[0],...f("door",{required:!0}),children:C(j,t=>l.jsx("option",{value:t,label:k(t)},t))})}),l.jsx(B,{label:"Tittel",type:"text",defaultValue:r.title,...f("title",{required:!0})}),l.jsx(B,{label:"Forfatter",type:"text",defaultValue:r.author,...f("author",{required:!0})}),l.jsx(B,{label:"Svar",note:"omringende whitespace blir ignorert",type:"text",defaultValue:r.answer,...f("answer",{required:!0})}),l.jsx(B,{label:"Aktiv fra",disabled:!0,type:"datetime-local",value:V(o)}),l.jsx(B,{label:"Aktiv til",disabled:!0,type:"datetime-local",value:V(a)}),l.jsx(Bt,{challenge:r,register:f,setValue:h,className:"col-span-3"}),l.jsx("div",{className:"col-span-3",children:l.jsx(I,{label:"Innhold",note:"tittel-elementet blir erstattet med tittel fra over",className:"col-span-3",children:l.jsx(Ve,{className:"form-textarea block w-full text-black",rows:5,defaultValue:r.markdown_content,...f("markdown_content",{required:!0})})})})]})]}),c&&N&&v&&l.jsx(se,{withoutInput:!0,challenge:{...N,content:v.html}})]})},he=x.memo($t),Mt=()=>{const{door:r}=ae(),i=ie(r,parseInt),u=K(),{data:c,isLoading:d}=ce(i),{mutate:f}=pt(),m=h=>{f({challenge:h},{onSuccess:()=>u(`/admin/doors?door=${h.door}`)})};return x.useLayoutEffect(()=>{(!i||!d&&!c)&&u("/admin/doors/new")},[i,d,c,u]),!i||d||!c?null:l.jsxs("div",{className:"space-y-16",children:[l.jsx("div",{className:"text-center",children:l.jsxs("span",{className:"text-4xl font-semibold",children:["Luke ",i]})}),l.jsx(he,{challenge:c,submit:m})]})},qt=({serviceMessage:r,newForm:i=!1,submit:u})=>{const{register:c,handleSubmit:d,setValue:f}=re({defaultValues:{...r,...!i&&{resolved_at:V(r.resolved_at??ut(new Date))}}}),{data:m}=R({select:h=>C(Ie(h),X)});return l.jsx("div",{className:"space-y-16",children:l.jsxs("form",{className:"space-y-8",onSubmit:d(u),children:[l.jsx("div",{className:"space-x-8",children:l.jsx(D,{type:"submit",children:"Lagre"})}),l.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[l.jsx(B,{label:"Innhold",type:"text",labelClassName:"col-span-3",className:"w-full",defaultValue:r.content,...c("content",{required:!0})}),!i&&l.jsx(B,{label:"L칮sning",type:"text",labelClassName:"col-span-3",className:"w-full",defaultValue:r.resolution_content??"",...c("resolution_content",{setValueAs:h=>T(h)?null:h})}),l.jsx(I,{label:"Luke",className:"col-span-3",defaultValue:r.resolution_content??"",children:l.jsxs("select",{className:"form-select block text-black",defaultValue:r.door??void 0,...c("door",{setValueAs:h=>T(h)?void 0:X(h)}),children:[l.jsx("option",{label:"-",value:""}),C(m,h=>l.jsx("option",{label:k(h),value:h},h))]})}),!i&&l.jsxs(l.Fragment,{children:[l.jsx(B,{label:"Opprettet",type:"datetime-local",value:V(r.created_at??""),disabled:!0}),l.jsxs("div",{children:[l.jsx(B,{label:"L칮sningstidspunkt",type:"datetime-local",...c("resolved_at")}),l.jsx(D,{type:"button",className:"!text-xs",onClick:()=>f("resolved_at",null),content:"Nullstill"})]})]})]})]})})},me=x.memo(qt),Lt=()=>{const{uuid:r}=ae(),i=K(),{data:u,isPending:c}=oe({select:m=>Oe(m,{uuid:r})}),{mutate:d}=vt(),f=m=>{ie(r,h=>d({uuid:h,service_message:m},{onSuccess:()=>i("/admin/service_messages")}))};return x.useEffect(()=>{!c&&!u&&i("/admin/service_messages/new")},[c,u,i]),c||!u?null:l.jsx(me,{serviceMessage:u,submit:f})},Dt=()=>{const r=K(),{mutate:i}=gt(),u=d=>{i({challenge:d},{onSuccess:()=>r(`/admin/doors?door=${d.door}`)})},c=de();return T(c)?l.jsx("div",{className:"text-center",children:l.jsx("span",{className:"text-4xl font-semibold",children:"Ingen ledige luker!"})}):l.jsx("div",{children:l.jsx(he,{newForm:!0,challenge:{door:c[0],title:"",author:"",answer:"",markdown_content:"",files:[]},submit:u})})},Pt=()=>{const r=K(),{mutate:i}=bt(),u=c=>{i({service_message:c},{onSuccess:()=>r("/admin/service_messages")})};return l.jsx(me,{newForm:!0,serviceMessage:{content:"",resolution_content:null,resolved_at:null,door:null},submit:u})},Ut=()=>{const{data:r,isLoading:i}=oe(),{mutate:u}=xt(),c=d=>{window.confirm("Sikker p친 at du vil slette driftsmelding?")&&u({uuid:d})};return i?null:l.jsxs("div",{children:[l.jsx(Re,{className:"place-self-center",children:"Driftsmeldinger"}),l.jsx("div",{className:"grid grid-cols-1 justify-items-center gap-12",children:T(r)?l.jsx("div",{children:"游꾻 Ingen driftsmeldinger. Livet er herlig! 游꾻"}):C(r,d=>l.jsxs("div",{className:"flex w-full flex-col gap-4",children:[l.jsxs("div",{className:"flex justify-end gap-8",children:[l.jsx(U,{to:`/admin/service_messages/${d.uuid}/edit`,content:"Rediger"}),l.jsx(D,{content:"Slett",onClick:()=>c(d.uuid)})]}),l.jsx(Qe,{serviceMessage:d})]},d.uuid))})]})},Tt=()=>{const r=K(),{pathname:i}=te(),u=x.useMemo(()=>P(i,"door")?P(i,"new")?"Ny luke":P(i,"edit")?"Rediger luke":"Luker":P(i,"service_message")?P(i,"new")?"Ny driftsmelding":P(i,"edit")?"Rediger driftsmelding":"Driftsmeldinger":"Admin",[i]),{data:c,isLoading:d}=ze();return x.useLayoutEffect(()=>{!d&&(!c||!c.is_admin)&&r("/")},[d,c,r]),!d&&(!c||!c.is_admin)?null:l.jsxs(He,{title:u,containerClassName:"place-self-center child:w-11/12 child:place-self-center relative",children:[l.jsx(ct,{}),l.jsxs(ke,{children:[l.jsx(L,{path:"doors",element:l.jsx(St,{})}),l.jsx(L,{path:"doors/new",element:l.jsx(Dt,{})}),l.jsx(L,{path:"doors/:door/edit",element:l.jsx(Mt,{})}),l.jsx(L,{path:"service_messages",element:l.jsx(Ut,{})}),l.jsx(L,{path:"service_messages/new",element:l.jsx(Pt,{})}),l.jsx(L,{path:"service_messages/:uuid/edit",element:l.jsx(Lt,{})}),l.jsx(L,{element:l.jsx(Ge,{to:"doors"})})]})]})};export{Tt as default};
